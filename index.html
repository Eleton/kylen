<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Vad har jag i kylen?</title>

	<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

	
	<link rel="stylesheet" type="text/css" href="css/fruitstyle.css">
</head>
<body>
	
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-offset-1 col-md-10" id="whiteBackground">
				<div id="header">
					<h1>Bäst före</h1>
				</div>
				<div class="col-md-4">
					<div class="fridge">
						<h2>Kylen</h2>
						<form>
							<input id="nameFieldFridge" type="text" name="article" placeholder="Artikelnamn">
							<input id="dateFieldFridge" type="date" name="month" placeholder="Bäst före-datum">
							<div><button type="button" onclick="extractDate()" name="submitArticle">Lägg in artikel</button></div>
						</form>
					</div>
				</div>
				<div class="col-md-4">
					<div class="fridge">
						<form>
							<input id="nameFieldFreezer" type="text" name="article">
							<input id="dateFieldFreezer" type="date" name="month">
							<button type="button" onclick="extractDate()" name="submitArticle">Lägg in artikel</button>
						</form>
					</div>
				</div>
				<div class="col-md-4">
					<div class="fridge">
						<form>
							<input id="nameField" type="text" name="article">
							<input id="dateField" type="date" name="month">
							<button type="button" onclick="extractDate()" name="submitArticle">Lägg in artikel</button>
						</form></div>
					</div>
				</div>
			</div>
		</div>



		<script type="text/javascript">
		var socket = io();
		var fridge = $(".fridge");
		socket.emit("fetchFood", true);
		socket.on("deliverFood", function(fridgeList){
			fridgeList.forEach(function(item){
				fridge.append(itemToHTML(item));
			})
		})
		var extractDate = function(){
			var newItem = new FoodItem($("#nameFieldFridge").val(), $("#dateFieldFridge").val());
			var htmlItem = itemToHTML(newItem);
			fridge.append(htmlItem);
			socket.emit("newItem", newItem);

		}


		var itemToHTML = function(item){
			var htmlItem = $("<div>").addClass("foodContainer");
			var foodName = $("<span>").addClass("foodName").text(item.name);
			var foodDate = $("<span>").addClass("foodDate").text(item.date);
			if(isPassedDate(item.date)){
				htmlItem.addClass("passedDate");
			}else if(isSuperShortDate(item.date)){
				htmlItem.addClass("superShortDate");
			}else if(isShortDate(item.date)){
				htmlItem.addClass("shortDate");
			}
			var closeButton = $('<img>',{class:'close',src:'close_icon.svg'});
			closeButton.on("click", function(){
				var article = $(this).parent();
				socket.emit("removeItem", article.attr("index"));
				$(this).parent().remove();
			})
			htmlItem.attr("index", item.index);
			htmlItem.append(foodName);
			htmlItem.append(closeButton);
			htmlItem.append(foodDate);
			htmlItem;
			return htmlItem;
		}
		
		var isPassedDate = function(date){
			var dateObj = new Date(date);
			return dateObj.getTime() - Date.now() < 1000*60*60*24*0;
		}

		var isShortDate = function(date){
			var dateObj = new Date(date);
			return dateObj.getTime() - Date.now() < 1000*60*60*24*7;
		}
		var isSuperShortDate = function(date){
			var dateObj = new Date(date);
			return dateObj.getTime() - Date.now() < 1000*60*60*24;
		}

		function FoodItem(name, date){
			this.name = name;
			this.date = new Date(date).toDateString();
			this.index = "" + Date.now();
		}
		</script>
	</body>
	</html>